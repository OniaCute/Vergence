package cc.vergence.modules.exploit;

import cc.vergence.features.enums.AntiCheats;
import cc.vergence.features.event.events.PacketEvent;
import cc.vergence.injections.accessors.PlayerMoveC2SPacketAccessor;
import cc.vergence.modules.Module;
import cc.vergence.modules.client.AntiCheat;
import cc.vergence.util.network.NetworkUtils;
import net.minecraft.network.packet.c2s.play.PlayerMoveC2SPacket;

public class Disabler extends Module {
    public Disabler() {
        super("Disabler", Category.EXPLOIT);
    }

    @Override
    public String getDetails() {
        return AntiCheat.INSTANCE != null ? AntiCheat.INSTANCE.antiCheat.getValue().name() : "Unknown";
    }

    public void onPacketSend(PacketEvent.Send event) {
        if (AntiCheat.INSTANCE == null && !AntiCheat.INSTANCE.getStatus()) {
            return;
        }

        if (event.getPacket() instanceof PlayerMoveC2SPacket packet && AntiCheat.INSTANCE.antiCheat.getValue().equals(AntiCheats.Grim)) {
            if (packet.changesLook()) {
                if (packet.changesPosition()) NetworkUtils.sendIgnoredPacket(new PlayerMoveC2SPacket.Full(packet.getX(mc.player.getX()), packet.getY(mc.player.getY()), packet.getZ(mc.player.getZ()), packet.getYaw(mc.player.getYaw()) + 11813401, packet.getPitch(mc.player.getPitch()), packet.isOnGround(), packet.horizontalCollision()));
                else NetworkUtils.sendIgnoredPacket(new PlayerMoveC2SPacket.LookAndOnGround(packet.getYaw(mc.player.getYaw()) + 11813401, packet.getPitch(mc.player.getPitch()), packet.isOnGround(), packet.horizontalCollision()));

                ((PlayerMoveC2SPacketAccessor) packet).setYaw(packet.getYaw(mc.player.getYaw()) + 11813400);
            } else {
                if (packet.changesPosition()) {
                    NetworkUtils.sendIgnoredPacket(new PlayerMoveC2SPacket.Full(packet.getX(mc.player.getX()), packet.getY(mc.player.getY()), packet.getZ(mc.player.getZ()), packet.getYaw(mc.player.getYaw()) + 11813401, packet.getPitch(mc.player.getPitch()), packet.isOnGround(), packet.horizontalCollision()));
                    NetworkUtils.sendIgnoredPacket(new PlayerMoveC2SPacket.Full(packet.getX(mc.player.getX()), packet.getY(mc.player.getY()), packet.getZ(mc.player.getZ()), packet.getYaw(mc.player.getYaw()) + 11813400, packet.getPitch(mc.player.getPitch()), packet.isOnGround(), packet.horizontalCollision()));
                    event.cancel();
                } else {
                    NetworkUtils.sendIgnoredPacket(new PlayerMoveC2SPacket.LookAndOnGround(packet.getYaw(mc.player.getYaw()) + 11813401, packet.getPitch(mc.player.getPitch()), packet.isOnGround(), packet.horizontalCollision()));
                    NetworkUtils.sendIgnoredPacket(new PlayerMoveC2SPacket.LookAndOnGround(packet.getYaw(mc.player.getYaw()) + 11813400, packet.getPitch(mc.player.getPitch()), packet.isOnGround(), packet.horizontalCollision()));
                    event.cancel();
                }
            }
        }
    }
}
